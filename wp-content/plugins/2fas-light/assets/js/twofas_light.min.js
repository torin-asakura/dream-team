!function(i){const{__:e,sprintf:s}=wp.i18n;var n=5e3,a=i(".js-twofas-reload-qr-button"),o=i(".js-twofas-qr-image"),r=i(".js-twofas-private-key-value"),t=i(".js-twofas-show-private-key"),l=i(".js-twofas-light-notifications"),c=i(".js-twofas-light-totp-secret-input"),f=i(".js-twofas-light-totp-form"),d=i(".js-twofas-totp-submit"),u=i("#twofas-light-totp-token"),w=i(".js-twofas-totp-login-configuration-submit"),h=i("#twofas_light_backup_code"),p=i("#_wpnonce"),g=i(".js-twofas-light-trusted-devices-box"),m=i(".js-twofas-light-trusted-devices-wrapper"),_=i(".js-twofas-modal-remove-trusted-device"),b=i(".js-twofas-remove-trusted-device-confirm"),v=i(".js-twofas-how-to-add-a-new-device"),j=i(".js-twofas-modal-how-to-add-a-new-device"),k=i(".js-twofas-totp-switch"),y=i("#twofas-light-loginform"),C=i("#wp-submit"),x=i(".js-twofas-configuration-subheader"),S=i(".js-twofas-config-wrapper"),T=i(".js-twofas-configured-box"),D=i(".js-twofas-configured-box-content"),J=i(".js-twofas-light-date-content"),N=i(".js-twofas-remove-config"),O=i(".js-twofas-remove-bar-form"),Q=i(".js-twofas-config-bar"),R=i(".js-twofas-modal-private-key"),q=i(".js-twofas-modal-confirmation"),z=i(".js-twofas-modal-cancel"),P=i(".js-twofas-confirmation-confirm"),M=i(".js-twofas-modal-remove-config"),U=i(".js-twofas-remove-config-confirm"),E=i(".js-twofas-rate-plugin-prompt-box"),F=i(".js-twofas-close-rate-prompt"),H=i(".js-twofas-postpone-rate-prompt"),I=i(".js-twofas-step-cancel-btn"),Y=i(".js-twofas-step-back-btn"),A=i(".js-twofas-step-continue-btn"),B=i(".js-twofas-step-card"),G=i(".js-twofas-step-breadcrumb"),K=i(".js-twofas-backup-codes-box"),L=i(".js-twofas-generate-backup-codes"),V=i(".js-twofas-modal-backup-codes"),W=i(".js-twofas-modal-backup-codes-confirm"),X=i(".js-twofas-regenerate-backup-codes-confirm"),Z=i(".twofas-download-codes-link"),$=i(".js-twofas-danger-zone-box"),tt=i(".js-twofas-modal-toggle-totp"),at=i(".js-twofas-toggle-totp-confirm"),ot=i(".js-twofas-toggle-totp-cancel"),et=i(".js-twofas-how-backup-codes-works"),st=i(".js-twofas-modal-backup-log-in"),nt=i(".js-twofas-modal-login-configuration-step"),it=i('input[type="checkbox"][name^="role"]'),rt=i(".js-twofas-save-roles"),lt=i(".js-twofas-cancel-roles"),ct={initialized:!1,current:null,changed:null,update:function(t){this.current=t},change:function(t){JSON.stringify(t)!==JSON.stringify(this.current)?this.changed=t:this.changed=null}},ft=1,dt=!1,ut="",wt=null,ht=null;function pt(){k.val("totp_enabled"),gt("totp_enabled"),K.addClass("twofas-show"),g.addClass("twofas-show")}function gt(t){D.each(function(){i(this).attr("data-totp-status")===t?i(this).addClass("twofas-show"):i(this).removeClass("twofas-show")})}function mt(t,a){var o,a='<div class="twofas-light-toast js-twofas-light-toast twofas-light-toast-'+t+'"><div class="twofas-light-toast-content"><p>'+a+"</p></div></div>",e=l.append(a);e=e.children().last(),setTimeout(function(){e.addClass("twofas-show")},100),o=setTimeout(function(){e.removeClass("twofas-show"),setTimeout(function(){e.remove()},1e3)},n),e.on("click",function(){i(this).removeClass("twofas-show"),clearTimeout(o),setTimeout(function(){e.remove()},1e3)})}function _t(){var t;t=Math.floor(Date.now()/1e3),J.attr("data-timestamp-to-format",t),St(),T.hasClass("twofas-show")||T.addClass("twofas-show")}function bt(){i(ut).animate({opacity:0},250,function(){i(this).removeClass("twofas-show").css("opacity",""),dt=!1,ut=""})}function vt(t){t.preventDefault(),bt()}function jt(t){var a=u.val(),o=c.val();t.preventDefault(),d.attr("disabled",!0),Y.attr("disabled",!0),i.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_personal_settings,twofas_light_action:"twofas-light-configure-totp",twofas_light_totp_secret:o,twofas_light_totp_token:a,action:"twofas_light_ajax",security:p.val()},dataType:"json"}).done(function(t){xt((t=JSON.parse(JSON.stringify(t))).twofas_light_trusted_devices),u.val(""),mt("success",s(e("Two-factor authentication%shas been configured successfully.","2fas-light"),"<br />")),S.removeClass("twofas-show"),x.addClass("twofas-hidden"),T.addClass("twofas-show"),K.addClass("twofas-show"),g.addClass("twofas-show"),_t(),$.addClass("twofas-show"),Q.hasClass("twofas-show")&&Q.removeClass("twofas-show"),pt()}).fail(function(t){400===t.status?(u.val(""),mt("error",s(e("Token is invalid :(%sPlease try one more time.","2fas-light"),"<br />"))):mt("error",s(e("Something went wrong.%sPlease try one more time!","2fas-light"),"<br />"))}).always(function(){return d.attr("disabled",!1),Y.attr("disabled",!1),!1})}function kt(t){t.preventDefault(),i.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_personal_settings,twofas_light_action:"twofas-light-generate-backup-codes",action:"twofas_light_ajax",security:p.val()},dataType:"json"}).done(function(t){var t=JSON.parse(JSON.stringify(t)),o=i(".twofas-modal-codes");Z.attr("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t.join("\n"))),o.empty(),t.forEach(function(t,a){o.append("<h6>"+t+"</h6>"),i(".twofas-backup-codes-inputs").append('<input type="hidden" name="codes['+a+']" value="'+t+'" />')}),Qt(V,".js-twofas-modal-backup-codes"),i(".twofas-backup-codes-box-new").removeClass("twofas-show"),i(".twofas-backup-codes-box-current").addClass("twofas-show"),i(".twofas-backup-codes-box-current-stats").find("h5").html("5 backup codes left")}).error(function(t){t&&t.responseJSON&&t.responseJSON.error&&"Cannot perform this action because second factor is disabled."===t.responseJSON.error?mt("error","Cannot perform this action because <br />second factor is disabled."):mt("error","Couldn't generate backup codes.<br />Try one more time!")})}function yt(t){i.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_personal_settings,twofas_light_action:t,action:"twofas_light_ajax",security:p.val()},dataType:"json"}).done(function(t){"totp_enabled"===(t=(t=JSON.parse(JSON.stringify(t))).twofas_light_totp_status)&&pt(),"totp_disabled"===t&&(k.val("totp_disabled"),gt("totp_disabled"),K.removeClass("twofas-show"),g.removeClass("twofas-show"))}).error(function(){mt("error",s(e("Something went wrong.%sTry one more time!","2fas-light"),"<br />"))}).always(function(){k.attr("disabled",!1)})}function Ct(t){t.preventDefault(),lt.attr("disabled",!0),rt.attr("disabled",!0);var a={};a.obligatory=qt(),a.trusted=zt(),i.when(i.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_admin_settings,twofas_light_action:"twofas-light-update-obligatory-roles",action:"twofas_light_ajax",security:p.val(),obligatory_roles:a.obligatory},dataType:"json"}),i.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_admin_settings,twofas_light_action:"twofas-light-update-remember-browser-allowed-roles",action:"twofas_light_ajax",security:p.val(),remember_browser_allowed_roles:a.trusted},dataType:"json"})).then(function(){ct.update(a),mt("success",e("Roles has been updated","2fas-light"))},function(){Rt(ct.current),mt("error",s(e("Something went wrong.%sTry one more time!","2fas-light"),"<br />"))})}function xt(t){m.html(t),Tt()}function St(){Dt(J.filter("[data-timestamp-to-format]"))}function Tt(){Dt(m.find("table tbody [data-timestamp-to-format]"))}function Dt(t){return t.each(function(){var t,a,o,e,s,n=i(this).attr("data-timestamp-to-format");n&&(s=new Date(1e3*n),i(this).text((a=(t=s).getFullYear(),o=Jt(t.getMonth()+1),e=Jt(t.getDate()),n=Jt(t.getHours()),s=Jt(t.getMinutes()),t=Jt(t.getSeconds()),a+"-"+o+"-"+e+" "+n+":"+s+":"+t)))})}function Jt(t){return t<10?"0"+t:t}function Nt(){/\d{6}/.test(u.val())?d.prop("disabled",!1):d.prop("disabled","disabled")}function Ot(){switch((ft=3<ft?3:ft)<1&&(ft=1),B.each(function(){i(this).addClass("hidden")}),i('.js-twofas-step-card[data-step="'+ft+'"]').removeClass("hidden"),G.each(function(){i(this).removeClass("active")}),i('.js-twofas-step-breadcrumb[data-step="'+ft+'"]').addClass("active"),ft){case 1:Y.addClass("hidden"),A.removeClass("hidden"),d.addClass("hidden"),0<I.length&&I.removeClass("hidden");break;case 2:Y.removeClass("hidden"),A.removeClass("hidden"),d.addClass("hidden"),0<I.length&&I.addClass("hidden");break;case 3:Y.removeClass("hidden"),A.addClass("hidden"),d.removeClass("hidden"),u.trigger("focus"),Nt(),0<I.length&&I.addClass("hidden")}}function Qt(t,a){t.addClass("twofas-show").animate({opacity:1},500,function(){dt=!0,ut=a})}function Rt(t){i('input:checkbox[name^="role"]').each(function(){i(this).prop("checked",!1)}),i.each(t.obligatory,function(t,a){i('input:checkbox[name="role-obligatory"][value="'+a+'"]').prop("checked",!0)}),i.each(t.trusted,function(t,a){i('input:checkbox[name="role-trusted"][value="'+a+'"]').prop("checked",!0)})}function qt(){return i('input:checkbox[name="role-obligatory"]:checked').map(function(){return this.value}).get()}function zt(){return i('input:checkbox[name="role-trusted"]:checked').map(function(){return this.value}).get()}G.each(function(){i(this).hasClass("active")&&(ft=i(this).data("step"))}),t.on("click",function(t){t.preventDefault(),Qt(R,".js-twofas-modal-private-key")}),a.on("click",function(){Qt(q,".js-twofas-modal-confirmation")}),0<w.length?w.on("click",function(t){f.action=twofas_light.login_url,f.submit()}):(d.on("click",jt),f.on("submit",jt)),u.on("keypress",function(t){return/\d/.test(t.key)}),u.on("keyup",Nt),y.on("submit",function(){C.prop("disabled","disabled")}),N.on("click",function(t){t.preventDefault(),Qt(M,".js-twofas-modal-remove-config")}),U.on("click",function(t){t.preventDefault(),O.submit()}),z.on("click",vt),P.on("click",function(t){t.preventDefault(),a.prop("disabled","disabled"),bt(),jQuery.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_personal_settings,twofas_light_action:"twofas-light-reload-qr-code",action:"twofas_light_ajax",security:p.val()},dataType:"json"}).done(function(t){var a=(t=JSON.parse(JSON.stringify(t))).twofas_light_totp_secret,t=t.twofas_light_qr_code;o.attr("src",t),r.html(a),c.attr("value",a)}).error(function(){mt("error",s(e("Couldn't reload QR code.%sPlease try one more time!","2fas-light")))}).always(function(){a.prop("disabled",!1)})}),F.on("click",function(){E.addClass("closed"),jQuery.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_personal_settings,twofas_light_action:"twofas-light-hide-notice",action:"twofas_light_ajax",security:p.val()}})}),H.on("click",function(){E.addClass("closed"),jQuery.ajax({url:twofas_light.ajax_url,type:"post",data:{page:twofas_light.twofas_light_personal_settings,twofas_light_action:"twofas-light-postpone-notice",action:"twofas_light_ajax",security:p.val()}})}),b.on("click",function(t){t.preventDefault(),bt(),wt.attr("disabled",!0),i.ajax({url:twofas_light.ajax_url,type:"post",data:{device_id:ht,page:twofas_light.twofas_light_personal_settings,twofas_light_action:"twofas-light-remove-trusted-device",action:"twofas_light_ajax",security:p.val()},dataType:"json"}).done(function(t){xt((t=JSON.parse(JSON.stringify(t))).twofas_light_trusted_devices),mt("success",s(e("Trusted browser%shas been removed","2fas-light"),"<br />"))}).error(function(){mt("error",s(e("Couldn't remove web browser/device.%sPlease try one more time!","2fas-light"),"<br />"))}).always(function(){wt.attr("disabled",!1),wt=ht=null})}),v.on("click",function(t){t.preventDefault(),Qt(j,".js-twofas-modal-how-to-add-a-new-device")}),h.on("keyup",function(){var t=this.value.replace(/-/g,"").toUpperCase(),a=this.selectionStart,o=t.substr(0,4),e=t.substr(4,4),t=t.substr(8,4);e.length?(t.length?this.value=[o,e,t].join("-"):this.value=[o,e].join("-"),a<=4&&this.setSelectionRange(a,a),5===a&&this.setSelectionRange(a+1,a+1)):this.value=o}),A.on("click",function(){ft++,Ot()}),Y.on("click",function(){ft--,Ot()}),L.on("click",kt),X.on("click",function(t){bt(),kt(t)}),at.on("click",function(){k.attr("disabled",!0),yt("twofas-light-totp-disable"),bt()}),ot.on("click",function(t){vt(t),k.attr("disabled",!1)}),et.on("click",function(t){t.preventDefault(),Qt(st,".js-twofas-modal-backup-log-in")}),it.on("click",function a(){var t={};t.obligatory=qt();t.trusted=zt();ct.change(t);null!==ct.changed?(lt.attr("disabled",!1),rt.attr("disabled",!1),rt.on("click",Ct),lt.on("click",function(t){t.preventDefault(),Rt(ct.current),a()})):(lt.attr("disabled",!0),rt.attr("disabled",!0),rt.off("click"),lt.off("click"))}),i(document).on("click",".js-twofas-remove-trusted-device",function(t){t.preventDefault(),wt=i(this),ht=i(this).attr("data-device"),Qt(_,".js-twofas-modal-remove-trusted-device")}),i(document).on("click",".js-twofas-totp-switch",function(){k.attr("disabled",!0);if("totp_enabled"===k.val())return Qt(tt,".js-twofas-modal-toggle-totp"),!1;yt("twofas-light-totp-enable")}),i(document).on("click",".js-twofas-regenerate-backup-codes",function(t){t.preventDefault(),Qt(W,".js-twofas-modal-backup-codes-confirm")}),i(document).on("keyup",function(t){27===t.keyCode&&bt()}),i(document).on("mouseup",function(t){dt&&function(t){var a;dt&&((a=i(ut).find(".twofas-modal").first()).is(t.target)||0!==a.has(t.target).length||bt())}(t)}),i(document).on("ready",function(){0<nt.length&&Qt(nt,".js-twofas-modal-login-configuration-step")}),i(document).on("ready",Ot),St(),Tt(),ct.initialized||((it={}).obligatory=qt(),it.trusted=zt(),ct.current=it,ct.initialized=!0)}(jQuery);